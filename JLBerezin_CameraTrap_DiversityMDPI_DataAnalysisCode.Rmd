---
Manuscript title: "A snapshot into the lives of elephants: Camera traps and conservation in Etosha National Park, Namibia"
Authors: "Jodie L. Berezin, Amanda J. Odom, Virginia Hayssen, Caitlin E. O'Connell-Rodwell"
Date of final update: 'October 16th, 2023'
---

*About:*
The script below can be used to recreate the statistical analyses and conclusions reported in the manuscript using the appropriate data sets.
Any questions regarding the data or scripts can be directed to the corresponding authors: JLB, jlberezin[at]gmail.com or CEO-R, ceoconnell[at]stanford.edu

*Outline*
1. Set up and data import
2. Data Analysis
  2a. Seasonal group occurrences
  2b. Seasonal group sizes
  2c. Diurnal occurrences
3. Observer reliability
  3a. Intra-observer
  3b. Inter-observer

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# 1. Set up and data import

## set the working directory
```{r}
setwd()
```


## load libraries
```{r}
library(readr) # for loading the data
library(ggpubr) # for making the graphs
library(irr) # for observer reliability
library(tidyverse) # for wrangling and piping
```


## load the data
```{r}
# grouping patterns data
cameratrap <- read_csv("JLBerezinetal_CameraTrap_DiversityMDPI_GroupPatternsData.csv")
View(cameratrap)

# observer reliability data
IRR <- read_csv("JLBerezinetal_CameraTrap_DiversityMDPI_ObserverReliabilityData.csv")
view(IRR)
```


# 2. Data Analysis

*This section is dedicated to the data analysis for seasonal group and diurnal group analysis.*

## Wrangling
```{r}
str(cameratrap)

# change the variables of interest to factors
cameratrap$month <- as.factor(as.character(cameratrap$month))
cameratrap$TOD <- as.factor(as.character(cameratrap$TOD))
cameratrap$season <- as.factor(as.character(cameratrap$season))
cameratrap$group <- as.factor(as.character(cameratrap$group))

# check again
str(cameratrap)
```


## 2a. Seasonal group occurances

**Pearson’s Chi Square’ (χ2) contingency table test**

*Assumptions:*
1. The observations are independent counts. For example, it would not be appropriate to apply a χ2 goodness of fit test where observations are taken before and after an experimental intervention is applied to the same objects. **Met:** We assume each group is independent.

2. The expected counts are not too low. The rule of thumb is that the expected values (not the observed counts) should be greater than 5. If any of the expected values are below 5, the p-values generated by the test start to become less reliable. **Met:** After testing the lowest possible value, family group in the wet season, the expected value is 79, sufficient for this test.

### filter the data
```{r}
count.season <- cameratrap %>%
  group_by(season, group) %>%
  summarise(count = n())

count.season
```


### make the contigency table
```{r}
seasonal.activity <- xtabs(count ~ season + group, data = count.season)
seasonal.activity

# Check the lowest Value to test assumptions. Family (n = 248) in the wet season (n = 1396)
(248*1396)/4366 # 79.30 - our lowest observed value is higher than 5.
```

### modeling
```{r}
chisq.test(seasonal.activity)
# significant, implying there is a relationship between group type and season.
# χ2 = 194.33, df = 3, p-value < 2.2e-16
```



## 2b. Seasonal group size

**Wilcoxon rank sum test for each group type**
Wilcoxon is the non-parametric version of the independent two-sample test. Our data is unpaired and does not meet normality assumptions.

*Assumptions:*
1. The dependent variable is continuous or ordinal. Met: Group size is the dependent and is continuous.
2. Independent variable has two categorical related groups or matched pairs. Met: Season is the independent (wet and dry) and is matched pairs, meaning different subjects are being compared in the two groups.
3. Independence of observations. Met: we are assuming that each group is independent because we are unable to differentiate between individuals.
4. The distributions of the samples of the independent groups have the same shape. Met: the wet and dry season group size distributions are both right skewed.


### Bull group size

#### filtering
```{r}
# filter the data
bullgroups <- cameratrap %>%
  filter(group == "bull") %>%
  select(season, group, count)

# check the distributions for both seasons
bullgroups.wet <- bullgroups %>%
  filter(season == "wet")

bullgroups.dry <- bullgroups %>%
  filter(season == "dry")

hist(bullgroups.wet$count, breaks = 13)
hist(bullgroups.dry$count, breaks = 13)

# both seasons distributions are right skewed
```

#### modeling
```{r}
bulls.wilcox <- wilcox.test(count ~ season, data = bullgroups, alternative = "two.sided", 
                            paired = F)
bulls.wilcox

# significantly different - p = 1.164e-06 or 0.000001164
```


### Family group size

#### filtering
```{r}
# filter the data
familygroups <- cameratrap %>%
  filter(group == "family") %>%
  select(season, group, count)

# check the distributions for both seasons
familygroups.wet <- familygroups %>%
  filter(season == "wet")

familygroups.dry <- familygroups %>%
  filter(season == "dry")

hist(familygroups.wet$count, breaks = 10)
hist(familygroups.dry$count, breaks = 10)

# both seasons distributions are right skewed
```

#### modeling
```{r}
family.wilcox <- wilcox.test(count ~ season, data = familygroups, alternative = "two.sided", 
                            paired = F)
family.wilcox

# not significantly different: p = 0.9975
```


### Mixed group size

#### filtering
```{r}
# filter the data
mixedgroups <- cameratrap %>%
  filter(group == "mixed") %>%
  select(season, group, count)

# check the distributions for both seasons
mixedgroups.wet <- mixedgroups %>%
  filter(season == "wet")

mixedgroups.dry <- mixedgroups %>%
  filter(season == "dry")

hist(mixedgroups.wet$count, breaks = 13)
hist(mixedgroups.dry$count, breaks = 13)

# both seasons distributions are somewhat closer to normal but right skewed
```

#### modeling
```{r}
mixed.wilcox <- wilcox.test(count ~ season, data = mixedgroups, alternative = "two.sided", 
                            paired = F)
mixed.wilcox

# not significantly different between seasons: p = 0.1624
```


## 2c. Diurnal group variation

**Pearson’s Chi Square’ (χ2) contingency table test**
We have two categorical variables, time of day (morning, midday, afternoon) and group type (solitary bull, bull, family, mixed).

*Assumptions:*
1. The observations are independent counts. For example, it would not be appropriate to apply a χ2 goodness of fit test where observations are taken before and after an experimental intervention is applied to the same objects. **Met:** We assume each group is independent.

2. The expected counts are not too low. The rule of thumb is that the expected values (again, not the observed counts) should be greater than 5. If any of the expected values are below 5, the p-values generated by the test start to become less reliable. **Met:** After testing the lowest possible value, family group in the morning, the expected value is 58, sufficient for this test.

### filter the data
```{r}
count.timeday <- cameratrap %>%
  group_by(TOD, group) %>%
  summarise(count = n())

count.timeday
```


### make the contingency table
```{r}
diurnal.activity <- xtabs(count ~ TOD + group, data = count.timeday)
diurnal.activity

# check the lowest value, family (n = 248) and morning (n = 1078) from Table 1
(248*1078)/4366 # 61.23 great so our lowest observed value is higher than 5! This means we have enough data for all other categories

```

### modeling
```{r}
chisq.test(diurnal.activity) # significant, implying that there is a relationship between the time of day and group types
# χ2 = 373.91, df = 6, p-value < 0.001
```



# 3. Observer reliability

*This section is dedicated to calculating the intra- (3 students) and inter- (5 students) observer reliability.*

## 3a. Intra-observer
Observers C, D, E

### Group Type

#### wrangling

select only the group type data
```{r}
intra_grouptype <- IRR %>%
  select(C_Type_R1, C_Type_R2, D_Type_R1, D_Type_R2, E_Type_R1, E_Type_R2)

# check the structure
str(intra_grouptype) # all character

# change to factors
intra_grouptype$C_Type_R1 <- as.factor(as.character(intra_grouptype$C_Type_R1))
intra_grouptype$C_Type_R2 <- as.factor(as.character(intra_grouptype$C_Type_R2))
intra_grouptype$D_Type_R1 <- as.factor(as.character(intra_grouptype$D_Type_R1))
intra_grouptype$D_Type_R2 <- as.factor(as.character(intra_grouptype$D_Type_R2))
intra_grouptype$E_Type_R1 <- as.factor(as.character(intra_grouptype$E_Type_R1))
intra_grouptype$E_Type_R2 <- as.factor(as.character(intra_grouptype$E_Type_R2))

# check again
str(intra_grouptype)
```

select each individual and then average the values
```{r}
C_intraGT <- intra_grouptype %>%
  select(C_Type_R1, C_Type_R2)

D_intraGT <- intra_grouptype %>%
  select(D_Type_R1, D_Type_R2)

E_intraGT <- intra_grouptype %>%
  select(E_Type_R1, E_Type_R2)
```


#### modeling

Cohen's kappa

```{r}
# Observer C - 0.893
kappa2(C_intraGT, weight = "unweighted")

# Observer D - 0.849
kappa2(D_intraGT, weight = "unweighted")

# Observer E - 0.939
kappa2(E_intraGT, weight = "unweighted")

# Average them for an overall score
mean(c(0.893,0.849,0.939)) # 0.894
```


### Group size

#### wrangling

select only the group size data
```{r}
intra_groupsize <- IRR %>%
  select(C_Size_R1, C_Size_R2, D_Size_R1, D_Size_R2, E_Size_R1, E_Size_R2)

# check the structure
str(intra_groupsize)
```

select each individual and then average the values
```{r}
C_intraGS <- intra_groupsize %>%
  select(C_Size_R1, C_Size_R2)

D_intraGS <- intra_groupsize %>%
  select(D_Size_R1, D_Size_R2)

E_intraGS <- intra_groupsize %>%
  select(E_Size_R1, E_Size_R2)
```


#### modeling

Intraclass correlation coefficient

```{r}
# Observer C - 0.997
icc(C_intraGS, model = "twoway", type = "agreement", unit = "single")

# Observer D - 0.994
icc(D_intraGS, model = "twoway", type = "agreement", unit = "single")

# Observer E - 0.994
icc(E_intraGS, model = "twoway", type = "agreement", unit = "single")

# Average them for the overall score
mean(c(0.997,0.994,0.994)) # 0.995
```


## 3b. Inter-observer
Observers A, B, C, D, E

### Group Type

#### wrangling
```{r}
# select only the group type data and the five students students
inter_grouptype <- IRR %>%
  select(A_Type_R1, B_Type_R1, C_Type_R1, D_Type_R1, E_Type_R1)

# check the structure
str(inter_grouptype) # all character

# change to factors
inter_grouptype$A_Type_R1 <- as.factor(as.character(inter_grouptype$A_Type_R1))
inter_grouptype$B_Type_R1 <- as.factor(as.character(inter_grouptype$B_Type_R1))
inter_grouptype$C_Type_R1 <- as.factor(as.character(inter_grouptype$C_Type_R1))
inter_grouptype$D_Type_R1 <- as.factor(as.character(inter_grouptype$D_Type_R1))
inter_grouptype$E_Type_R1 <- as.factor(as.character(inter_grouptype$E_Type_R1))

# check again
str(inter_grouptype)
```

#### modeling

Fleiss' kappa for more than two, independent raters

```{r}
kappam.fleiss(inter_grouptype)

# 0.897
```


### Group Size

#### wrangling
```{r}
inter_groupsize <- IRR %>%
  select(A_Size_R1, B_Size_R1, C_Size_R1, D_Size_R1, E_Size_R1)

# check the structure
str(inter_groupsize)

```

#### modeling

Intraclass correlation coefficient

```{r}
# group size
icc(inter_groupsize, model = "twoway", type = "agreement", unit = "single")

# 0.997
```






